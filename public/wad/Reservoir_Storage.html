```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯æ°´å¡˜å³æ™‚å„²æ°´é‡</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #1a1a1a; 
            color: #e0e0e0; 
            height: 100vh;
            overflow: hidden;
        }
        #map { 
            width: 100%; 
            height: 100vh; 
        }
        .info-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            width: 300px;
            height: 80%;
            background-color: rgba(42, 42, 42, 0.8);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #444;
            z-index: 1000;
            overflow-y: auto;
            pointer-events: auto;
        }
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: rgba(42, 42, 42, 0.8);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #444;
            z-index: 1000;
        }
        .legend h3 { 
            color: #fff; 
            margin: 0 0 10px 0; 
            font-size: 14px;
        }
        .legend ul { 
            list-style: none; 
            margin: 0; 
            padding: 0; 
        }
        .legend li { 
            margin-bottom: 5px; 
            color: #ccc; 
            font-size: 12px;
        }
        .legend-dot, .row-dot {
            font-size: 16px;
            margin-right: 5px;
            line-height: 1;
        }
        .low-dot { color: #ff4444; }
        .mid-dot { color: #ffaa00; }
        .high-dot { color: #44ff44; }
        .full-dot { color: #4444ff; }
        .total { 
            font-weight: bold; 
            color: #4caf50; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 10px; 
        }
        th, td { 
            border: 1px solid #444; 
            padding: 8px; 
            text-align: left; 
        }
        th { 
            background-color: #333; 
        }
        .loading { color: #ccc; }
        .custom-tooltip {
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            border: none;
            border-radius: 3px;
            padding: 2px 5px;
            font-size: 11px;
            white-space: nowrap;
        }
        @media (max-width: 768px) {
            .info-panel {
                position: static;
                width: 100%;
                height: 40%;
                margin: 0;
                border-radius: 0;
            }
            #map { height: 60%; }
            .legend { position: static; margin: 10px; }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="info-panel">
        <h1>ğŸŒŠ é¦™æ¸¯æ°´å¡˜å³æ™‚å„²æ°´é‡</h1>
        <p id="updateDate">æœ€å¾Œæ›´æ–°: è¼‰å…¥ä¸­...</p>
        <p id="totalInfo" class="total loading">ç¸½å„²æ°´é‡: è¼‰å…¥ä¸­...</p>

        <table id="reservoirTable">
            <thead>
                <tr>
                    <th>æ°´ä½</th>
                    <th>æ°´å¡˜åç¨±</th>
                    <th>å„²æ°´é‡ (ç™¾è¬ç«‹æ–¹ç±³)</th>
                    <th>æ»¿æ°´ä½ (%)</th>
                </tr>
            </thead>
            <tbody>
                <!-- æ•¸æ“šæœƒç”±JSå‹•æ…‹å¡«å…… -->
            </tbody>
        </table>
    </div>
    <div class="legend">
        <h3>æ°´ä½åˆ†é¡</h3>
        <ul>
            <li><span class="legend-dot low-dot">â—</span>ä½æ°´ä½ (&lt; 50%)</li>
            <li><span class="legend-dot mid-dot">â—</span>ä¸­æ°´ä½ (50-75%)</li>
            <li><span class="legend-dot high-dot">â—</span>é«˜æ°´ä½ (75-95%)</li>
            <li><span class="legend-dot full-dot">â—</span>æ»¿æ°´ä½ (&gt; 95%)</li>
        </ul>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // å›ºå®šå®¹é‡æ•¸æ“šï¼ˆç”¨æ–¼è¨ˆç®—ç¸½é‡ï¼‰
        const capacities = {
            'è–„æ‰¶æ—æ°´å¡˜': 0.233,
            'é¦™æ¸¯ä»”ä¸‹æ°´å¡˜': 0.486,
            'é¦™æ¸¯ä»”ä¸Šæ°´å¡˜': 0.773,
            'å¤§æ½­æ¿¾æ°´å¡˜': 0.080,
            'å¤§æ½­ä¸­æ°´å¡˜': 0.686,
            'å¤§æ½­ç¯¤æ°´å¡˜': 6.047,
            'å¤§æ½­ä¸Šæ°´å¡˜': 1.490,
            'çŸ³å´—æ°´å¡˜': 24.461,
            'ä¹é¾æ¿¾æ°´å¡˜': 0.800,
            'ä¹é¾æ°´å¡˜': 1.578,
            'çŸ³æ¢¨è²æ°´å¡˜': 0.374,
            'åŸé–€ä¸‹æ°´å¡˜': 4.299,
            'ä¹é¾æ¥æ”¶æ°´å¡˜': 0.121,
            'åŸé–€æ°´å¡˜': 13.279,
            'å¤§æ¬–æ¶Œæ°´å¡˜': 20.490,
            'èˆ¹ç£æ·¡æ°´æ¹–': 229.729,
            'è¬å®œæ°´åº«': 281.124
        };

        // ä¸­è‹±åç¨±æ˜ å°„
        const nameMap = {
            'Pok Fu Lam Reservoir': 'è–„æ‰¶æ—æ°´å¡˜',
            'Aberdeen Lower Reservoir': 'é¦™æ¸¯ä»”ä¸‹æ°´å¡˜',
            'Aberdeen Upper Reservoir': 'é¦™æ¸¯ä»”ä¸Šæ°´å¡˜',
            'Tai Tam Byewash Reservoir': 'å¤§æ½­æ¿¾æ°´å¡˜',
            'Tai Tam Intermediate Reservoir': 'å¤§æ½­ä¸­æ°´å¡˜',
            'Tai Tam Tuk Reservoir': 'å¤§æ½­ç¯¤æ°´å¡˜',
            'Tai Tam Upper Reservoir': 'å¤§æ½­ä¸Šæ°´å¡˜',
            'Shek Pik Reservoir': 'çŸ³å´—æ°´å¡˜',
            'Kowloon Byewash Reservoir': 'ä¹é¾æ¿¾æ°´å¡˜',
            'Kowloon Reservoir': 'ä¹é¾æ°´å¡˜',
            'Shek Lei Pui Reservoir': 'çŸ³æ¢¨è²æ°´å¡˜',
            'Lower Shing Mun Reservoir': 'åŸé–€ä¸‹æ°´å¡˜',
            'Kowloon Reception Reservoir': 'ä¹é¾æ¥æ”¶æ°´å¡˜',
            'Shing Mun Reservoir': 'åŸé–€æ°´å¡˜',
            'Tai Lam Chung Reservoir': 'å¤§æ¬–æ¶Œæ°´å¡˜',
            'Plover Cove Reservoir': 'èˆ¹ç£æ·¡æ°´æ¹–',
            'High Island Reservoir': 'è¬å®œæ°´åº«'
        };

        // åº§æ¨™æ•¸æ“š
        const coords = {
            'è–„æ‰¶æ—æ°´å¡˜': {lat: 22.265, lng: 114.137},
            'é¦™æ¸¯ä»”ä¸‹æ°´å¡˜': {lat: 22.251, lng: 114.190},
            'é¦™æ¸¯ä»”ä¸Šæ°´å¡˜': {lat: 22.255, lng: 114.185},
            'å¤§æ½­æ¿¾æ°´å¡˜': {lat: 22.256, lng: 114.212},
            'å¤§æ½­ä¸­æ°´å¡˜': {lat: 22.246, lng: 114.210},
            'å¤§æ½­ç¯¤æ°´å¡˜': {lat: 22.243, lng: 114.220},
            'å¤§æ½­ä¸Šæ°´å¡˜': {lat: 22.260, lng: 114.210},
            'çŸ³å´—æ°´å¡˜': {lat: 22.228, lng: 113.895},
            'ä¹é¾æ¿¾æ°´å¡˜': {lat: 22.350, lng: 114.150},
            'ä¹é¾æ°´å¡˜': {lat: 22.354, lng: 114.153},
            'çŸ³æ¢¨è²æ°´å¡˜': {lat: 22.350, lng: 114.130},
            'åŸé–€ä¸‹æ°´å¡˜': {lat: 22.373, lng: 114.159},
            'ä¹é¾æ¥æ”¶æ°´å¡˜': {lat: 22.350, lng: 114.150},
            'åŸé–€æ°´å¡˜': {lat: 22.386, lng: 114.147},
            'å¤§æ¬–æ¶Œæ°´å¡˜': {lat: 22.384, lng: 114.031},
            'èˆ¹ç£æ·¡æ°´æ¹–': {lat: 22.471, lng: 114.253},
            'è¬å®œæ°´åº«': {lat: 22.375, lng: 114.351}
        };

        // Fallbackæ•¸æ“šï¼ˆæœ€æ–°å®˜æ–¹2025-09-16ï¼‰
        const fallbackData = [
            {name: 'è–„æ‰¶æ—æ°´å¡˜', storage: 0.181, capacity: 0.233, percent: 77.68, cls: 'high'},
            {name: 'é¦™æ¸¯ä»”ä¸‹æ°´å¡˜', storage: 0.486, capacity: 0.486, percent: 100.00, cls: 'full'},
            {name: 'é¦™æ¸¯ä»”ä¸Šæ°´å¡˜', storage: 0.773, capacity: 0.773, percent: 100.00, cls: 'full'},
            {name: 'å¤§æ½­æ¿¾æ°´å¡˜', storage: 0.080, capacity: 0.080, percent: 100.00, cls: 'full'},
            {name: 'å¤§æ½­ä¸­æ°´å¡˜', storage: 0.683, capacity: 0.686, percent: 99.56, cls: 'high'},
            {name: 'å¤§æ½­ç¯¤æ°´å¡˜', storage: 6.019, capacity: 6.047, percent: 99.54, cls: 'high'},
            {name: 'å¤§æ½­ä¸Šæ°´å¡˜', storage: 1.463, capacity: 1.490, percent: 98.19, cls: 'high'},
            {name: 'çŸ³å´—æ°´å¡˜', storage: 24.461, capacity: 24.461, percent: 100.00, cls: 'full'},
            {name: 'ä¹é¾æ¿¾æ°´å¡˜', storage: 0.450, capacity: 0.800, percent: 56.25, cls: 'mid'},
            {name: 'ä¹é¾æ°´å¡˜', storage: 1.284, capacity: 1.578, percent: 81.37, cls: 'high'},
            {name: 'çŸ³æ¢¨è²æ°´å¡˜', storage: 0.374, capacity: 0.374, percent: 100.00, cls: 'full'},
            {name: 'åŸé–€ä¸‹æ°´å¡˜', storage: 0.801, capacity: 4.299, percent: 18.63, cls: 'low'},
            {name: 'ä¹é¾æ¥æ”¶æ°´å¡˜', storage: 0.121, capacity: 0.121, percent: 100.00, cls: 'full'},
            {name: 'åŸé–€æ°´å¡˜', storage: 11.693, capacity: 13.279, percent: 88.06, cls: 'high'},
            {name: 'å¤§æ¬–æ¶Œæ°´å¡˜', storage: 18.854, capacity: 20.490, percent: 92.02, cls: 'high'},
            {name: 'èˆ¹ç£æ·¡æ°´æ¹–', storage: 209.215, capacity: 229.729, percent: 91.07, cls: 'high'},
            {name: 'è¬å®œæ°´åº«', storage: 222.908, capacity: 281.124, percent: 79.29, cls: 'mid'}
        ];

        // åˆå§‹åŒ–åœ°åœ–
        var map = L.map('map').setView([22.3, 114.2], 11);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: 'Â© OpenStreetMap contributors Â© CARTO'
        }).addTo(map);

        var markers = {};
        var reservoirs = []; // å„²å­˜æ•¸æ“š

        // é¡è‰²æ˜ å°„åŒåˆ†é¡å‡½æ•¸
        var colors = {low: '#ff4444', mid: '#ffaa00', high: '#44ff44', full: '#4444ff'};
        function getClass(percent) {
            if (percent < 50) return 'low';
            if (percent < 75) return 'mid';
            if (percent <= 95) return 'high';
            return 'full';
        }
        function getDotClass(cls) { return cls + '-dot'; }
        function getCoords(name) {
            return coords[name] || {lat: 22.3, lng: 114.2};
        }

        // æ›´æ–°DOMå‡½æ•¸
        function updateDOM(data) {
            const totalStorage = data.reduce((sum, res) => sum + res.storage, 0);
            const totalCapacity = Object.values(capacities).reduce((a, b) => a + b, 0);
            const totalPercent = (totalStorage / totalCapacity * 100).toFixed(2);

            document.getElementById('updateDate').textContent = `æœ€å¾Œæ›´æ–°: ${new Date().toLocaleString('zh-TW')}`;
            document.getElementById('totalInfo').innerHTML = `ç¸½å„²æ°´é‡: ${totalStorage.toFixed(3)} / ${totalCapacity.toFixed(3)} ç™¾è¬ç«‹æ–¹ç±³ (${totalPercent}%)`;

            // æ›´æ–°è¡¨æ ¼
            const tbody = document.querySelector('#reservoirTable tbody');
            tbody.innerHTML = '';
            data.forEach(res => {
                const row = `<tr>
                    <td><span class="row-dot ${getDotClass(res.cls)}">â—</span></td>
                    <td>${res.name}</td>
                    <td>${res.storage.toFixed(3)}</td>
                    <td>${res.percent.toFixed(2)}%</td>
                </tr>`;
                tbody.innerHTML += row;
            });

            // æ›´æ–°åœ°åœ–
            updateMap(data);
        }

        // æ›´æ–°åœ°åœ–markerï¼ˆåŠ æ†å¸¸tooltipé¡¯ç¤ºåå­—+ %ï¼‰
        function updateMap(data) {
            Object.values(markers).forEach(m => map.removeLayer(m));
            markers = {};

            data.forEach(function(res) {
                const latlng = getCoords(res.name);
                var marker = L.circleMarker([latlng.lat, latlng.lng], {
                    radius: 6,
                    fillColor: colors[res.cls],
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);

                // æ†å¸¸tooltipï¼šé¡¯ç¤ºåå­— + %
                var tooltipContent = `${res.name}<br>${res.percent.toFixed(2)}%`;
                marker.bindTooltip(tooltipContent, {
                    permanent: true,
                    direction: 'top',
                    offset: [0, -10],
                    className: 'custom-tooltip'
                });

                // é»æ“Špopupé¡¯ç¤ºè©³ç´°è³‡æ–™
                var popupContent = '<b>' + res.name + '</b><br>' +
                                   'å„²æ°´é‡: ' + res.storage.toFixed(3) + ' MmÂ³<br>' +
                                   'æ»¿æ°´ä½: ' + res.percent.toFixed(2) + '%';
                marker.bindPopup(popupContent);
                markers[res.name] = marker;
            });
        }

        // fetchæ•¸æ“šå‡½æ•¸ï¼ˆåŠ fallbackï¼‰
        async function fetchData() {
            try {
                const proxyUrl = 'https://corsproxy.io/?';
                const url = 'https://www.wsd.gov.hk/en/core-businesses/operation-and-maintenance-of-waterworks/waterworks/current-storage-position-of-impounding-reservoirs/index.html';
                console.log('Fetching from:', proxyUrl + encodeURIComponent(url));
                const response = await fetch(proxyUrl + encodeURIComponent(url));
                if (!response.ok) throw new Error('HTTP error: ' + response.status);
                const htmlText = await response.text();
                console.log('HTML fetched, length:', htmlText.length);
                const html = new DOMParser().parseFromString(htmlText, 'text/html');

                const table = html.querySelector('table');
                if (!table) throw new Error('è¡¨æ ¼æœªæ‰¾åˆ°');
                const rows = table.querySelectorAll('tr');
                let fetchedData = [];
                let totalStorage = 0;

                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].querySelectorAll('td');
                    if (cells.length >= 3) {
                        const enName = cells[0].textContent.trim();
                        const storageStr = cells[1].textContent.trim().replace(/[^\d.]/g, '');
                        const percentStr = cells[2].textContent.trim().replace('%', '');
                        const storage = parseFloat(storageStr) || 0;
                        const percent = parseFloat(percentStr) || 0;
                        const cnName = nameMap[enName];
                        if (cnName) {
                            const capacity = capacities[cnName] || 0;
                            const cls = getClass(percent);
                            fetchedData.push({name: cnName, storage, capacity, percent, cls});
                            totalStorage += storage;
                        }
                    }
                }

                if (fetchedData.length > 0) {
                    reservoirs = fetchedData;
                    updateDOM(reservoirs);
                    console.log('FetchæˆåŠŸï¼Œæ•¸æ“šæ•¸é‡:', fetchedData.length);
                    return;
                } else {
                    throw new Error('ç„¡æ•¸æ“šè§£æ');
                }
            } catch (error) {
                console.error('FetchéŒ¯èª¤:', error);
                // Fallbackåˆ°éœæ…‹
                reservoirs = fallbackData;
                updateDOM(reservoirs);
            }
        }

        // åˆå§‹è¼‰å…¥åŒè‡ªå‹•æ›´æ–°
        fetchData();
        setInterval(fetchData, 600000); // æ¯10åˆ†é˜
    </script>
</body>
</html>
```